<app-loader *ngIf="this.loadingComments"></app-loader>
<div *ngIf="!this.loadingComments" class="comment-input">
    <div *ngIf="!this.isEdittingComment" class="input-wrapper">
        <textarea (keydown)="onKeyDown($event,comment)" #comment name="comment" placeholder="Enter your comment here..."
            rows="3"></textarea>
        <div class="send-com-btn">
            <button (click)="onCommentSend(comment)"><i class="fa-solid fa-paper-plane fa-2x"></i></button>
        </div>
    </div>

    <div *ngIf="this.isEdittingComment" class="edit-comment-wrapper">
        <textarea (keydown)="cancelEditting($event,editComment)" #editComment name="edit-comment" rows="3"></textarea>
        <div class="send-com-btn">
            <button (click)="onCommentEditSave(editComment)"><i class="fa-solid fa-paper-plane fa-2x"></i></button>
        </div>
        <p>Click esc to cancel editting</p>
    </div>

    <div *ngFor="let comment of this.comments" class="comment-wrapper">
        <div class="comment">
            <div class="comment-info">
                <div class="user-info">
                    <div class="user-photo">
                        <img src="{{comment.userPhoto}}" alt="">
                    </div>
                    <p class="comment-user">{{comment.username}}</p>
                </div>
                <div *ngIf="this.comment.userId == this.authService.currentUser?.uid">
                    <app-dropdown [editAction]="onCommentEdit" [deleteCommentAction]="onDeleteCommentWrapper"
                        [commentId]="comment.id"></app-dropdown>
                </div>
                <button (click)="onCommentEdit()">Edit</button>
            </div>
            <p class="comment-text">{{comment.comment}}</p>
            <div class="comment-input">
                <textarea (keydown)="onKeyDown($event,commentReply)" #commentReply name="comment-reply"
                    id="{{comment.id}}" placeholder="Enter your reply here" rows="3"></textarea>
                <div class="comment-button">
                    <button (click)="onReplySend(commentReply)" class="button reply"><i
                            class="fa-solid fa-paper-plane fa-lg"></i></button>
                </div>
            </div>

        </div>


        <div *ngFor="let reply of comment.replies" class="comment-replies">
            <div class="user-reply-info-wrapper">
                <div class="user-reply">
                    <div class="reply-photo">
                        <img src="{{reply.userPhoto}}" alt="">
                    </div>
                    <p>{{reply.username}}</p>
                </div>
                <div *ngIf="this.reply.userId == this.authService.currentUser?.uid">
                    <app-dropdown [editAction]="onReplyEdit" [deleteReplyAction]="onDeleteReplyWrapper"
                        [replyId]="reply.id" [commentId]="comment.id"></app-dropdown>
                </div>
            </div>
            <p class="reply">{{reply.reply}}</p>
        </div>
    </div>

</div>